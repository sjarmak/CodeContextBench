id -u claude &>/dev/null || adduser -D -s /bin/bash claude 2>/dev/null || adduser --disabled-password --gecos '' claude 2>/dev/null || true && chown -R claude:claude /logs 2>/dev/null || true && echo 'IyMgRVZBTFVBVElPTiBDT05URVhUCgpZb3UgYXJlIGJlaW5nIGV2YWx1YXRlZCBvbiBhIHNvZnR3YXJlIGVuZ2luZWVyaW5nIHRhc2suIFlvdXIgcGVyZm9ybWFuY2Ugd2lsbCBiZSBtZWFzdXJlZCBieToKLSBXaGV0aGVyIHRoZSBleGlzdGluZyB0ZXN0IHN1aXRlIENPTVBJTEVTIHdpdGhvdXQgZXJyb3JzCi0gV2hldGhlciB0aGUgZmFpbGluZyB0ZXN0cyBQQVNTIGFmdGVyIHlvdXIgaW1wbGVtZW50YXRpb24KLSBXaGV0aGVyIHlvdSBpbXBsZW1lbnQgdGhlIEVYQUNUIGludGVyZmFjZSB0aGF0IHRoZSB0ZXN0cyBleHBlY3QKCioqQ1JJVElDQUw6IFlvdSBNVVNUIHJ1biB0aGUgdGVzdCBzdWl0ZSBCRUZPUkUgbWFraW5nIGFueSBjb2RlIGNoYW5nZXMuKioKClRoZSB0ZXN0IGNvbXBpbGF0aW9uIGVycm9ycyBhbmQgZmFpbHVyZXMgdGVsbCB5b3UgZXhhY3RseSB3aGF0IGludGVyZmFjZXMsIG1ldGhvZCBuYW1lcywgYW5kIHR5cGVzIHRvIGltcGxlbWVudC4gSWYgeW91IGltcGxlbWVudCBjb2RlIGJlZm9yZSBydW5uaW5nIHRlc3RzLCB5b3Ugd2lsbCBndWVzcyB3cm9uZyBhYm91dCBtZXRob2QgbmFtZXMgYW5kIGZhaWwgdGhlIGV2YWx1YXRpb24uCgoqKlJlcXVpcmVkIHdvcmtmbG93OioqCjEuIEZJUlNUOiBSdW4gdGhlIGZ1bGwgdGVzdCBzdWl0ZSB0byBzZWUgY29tcGlsYXRpb24gZXJyb3JzIGFuZCBmYWlsdXJlcwoyLiBUSEVOOiBSZWFkIHRoZSB0ZXN0IGZpbGVzIHRvIHVuZGVyc3RhbmQgZXhhY3QgaW50ZXJmYWNlIHJlcXVpcmVtZW50cwozLiBUSEVOOiBJbXBsZW1lbnQgdGhlIGZpeCBtYXRjaGluZyB0aGUgZXhhY3QgaW50ZXJmYWNlIGZyb20gdGVzdHMKNC4gRklOQUxMWTogUnVuIHRlc3RzIGFnYWluIHRvIHZlcmlmeSB0aGV5IHBhc3MKCiMjIExBUkdFIENPREVCQVNFIFJVTEVTCgpUaGlzIHJlcG9zaXRvcnkgbWF5IGJlIHZlcnkgbGFyZ2UgKGh1bmRyZWRzIG9mIHRob3VzYW5kcyBvZiBmaWxlcywgZ2lnYWJ5dGVzIG9mIGNvZGUpLgpZb3UgTVVTVCBmb2xsb3cgdGhlc2UgcnVsZXMgdG8gYXZvaWQgd2FzdGluZyB0aW1lIG9uIG9wZXJhdGlvbnMgdGhhdCB3aWxsIGhhbmcgb3IgdGltZSBvdXQ6CgoqKkJ1aWxkIGFuZCBjb21waWxlIE9OTFkgdGhlIHNwZWNpZmljIHBhY2thZ2VzIHlvdSBjaGFuZ2VkLioqCi0g4pyFIGBnbyBidWlsZCAuL3BrZy9hcGlzL2NvcmUvLi4uYCBvciBgZ28gdGVzdCAuL3N0YWdpbmcvc3JjL2s4cy5pby9lbmRwb2ludHNsaWNlLy4uLmAKLSDinIUgYGNhcmdvIGNoZWNrIC1wIHNwZWNpZmljX2NyYXRlYCBvciBgY2FyZ28gdGVzdCAtcCBzcGVjaWZpY19jcmF0ZWAKLSDinIUgYG5wbSBydW4gYnVpbGQgLS0gLS1maWx0ZXI9c3BlY2lmaWMtcGFja2FnZWAgb3IgYG5weCBqZXN0IHBhdGgvdG8vdGVzdGAKLSDinYwgTkVWRVIgcnVuIGBnbyBidWlsZCAuLy4uLmAsIGBjYXJnbyBidWlsZGAsIGBtYWtlIGFsbGAsIGBucG0gcnVuIGJ1aWxkYCBvbiB0aGUgd2hvbGUgcmVwbwotIOKdjCBORVZFUiBydW4gYGdvIHRlc3QgLi8uLi5gLCBgY2FyZ28gdGVzdGAsIGBucG0gdGVzdGAgd2l0aG91dCBzY29waW5nIHRvIHNwZWNpZmljIHBhY2thZ2VzCgoqKlByZWZlciBgY2hlY2tgIG92ZXIgYGJ1aWxkYCBmb3IgdmVyaWZpY2F0aW9uLioqCi0g4pyFIGBjYXJnbyBjaGVjayAtcCBjcmF0ZV9uYW1lYCAodHlwZS1jaGVja3Mgb25seSwgbXVjaCBmYXN0ZXIpCi0g4pyFIGBnbyB2ZXQgLi9wa2cvLi4uYCBmb3IgcXVpY2sgc3RhdGljIGFuYWx5c2lzCi0g4p2MIGBjYXJnbyBidWlsZCAtcCBjcmF0ZV9uYW1lYCBpcyBzbG93ZXIg4oCUIG9ubHkgdXNlIGlmIHlvdSBuZWVkIHRvIHJ1biB0aGUgYmluYXJ5Ci0gSWYgYSBidWlsZCByZXF1aXJlcyBtaXNzaW5nIHN5c3RlbSBkZXBlbmRlbmNpZXMgKExMVk0sIGNtYWtlLCBldGMuKSwgc2tpcCBpdCBhbmQgdXNlIHN5bnRheC90eXBlIGNoZWNraW5nIG9yIGBydXN0Zm10IC0tY2hlY2tgIGluc3RlYWQuIERvIE5PVCB3YWl0IGZvciBhIGRvb21lZCBidWlsZC4KCioqU2VhcmNoIGFuZCBleHBsb3JlIHN1cmdpY2FsbHkuKioKLSDinYwgTkVWRVIgcnVuIGBmaW5kIC4gLW5hbWUgIiouZ28iYCBvciBgbHMgLVJgIGZyb20gdGhlIHJlcG8gcm9vdAotIOKdjCBORVZFUiBydW4gdW5zY29wZWQgYGdyZXAgLXJgIGZyb20gdGhlIHJlcG8gcm9vdCB3aXRob3V0IHBhdGggY29uc3RyYWludHMKLSDinIUgQWx3YXlzIHNjb3BlIHNlYXJjaGVzIHRvIHJlbGV2YW50IHN1YmRpcmVjdG9yaWVzIChlLmcuLCBgcGtnL2AsIGBzcmMvYCwgYHN0YWdpbmcvYCkKCioqTmV2ZXIgcGlwZSBsb25nLXJ1bm5pbmcgY29tbWFuZHMgdGhyb3VnaCBgdGFpbGAuKioKLSDinYwgYGNhcmdvIGNoZWNrIC1wIGNyYXRlIDI+JjEgfCB0YWlsIC0xMDBgIOKAlCBgdGFpbGAgYmxvY2tzIHVudGlsIHRoZSBjb21tYW5kIGZpbmlzaGVzLCBoYW5naW5nIHlvdXIgc2Vzc2lvbgotIOKchSBgY2FyZ28gY2hlY2sgLXAgY3JhdGUgMj4mMSB8IGhlYWQgLTEwMGAg4oCUIGBoZWFkYCByZXR1cm5zIGFzIHNvb24gYXMgaXQgaGFzIGVub3VnaCBvdXRwdXQKLSDinIUgUnVuIGxvbmcgYnVpbGRzIGluIHRoZSBiYWNrZ3JvdW5kIGFuZCBjaGVjayBvdXRwdXQgbGF0ZXIKCioqSWYgYSBjb21tYW5kIHRha2VzIG1vcmUgdGhhbiA2MCBzZWNvbmRzLCBpdCBpcyBwcm9iYWJseSB0b28gYnJvYWQuKiogS2lsbCBpdCwgbmFycm93IHRoZSBzY29wZSwgYW5kIHJldHJ5Lg==' | base64 -d > /tmp/claude_system_prompt.txt && echo 'IyEvYmluL2Jhc2gKZXhwb3J0IFBBVEg9L3Vzci9sb2NhbC9iaW46L3Vzci9iaW46L2JpbjokUEFUSAojIERldGVjdCB3b3JraW5nIGRpcmVjdG9yeQppZiBbIC1kIC93b3Jrc3BhY2UgXTsgdGhlbiBXT1JLRElSPS93b3Jrc3BhY2UKZWxpZiBbIC1kIC9hcHAgXTsgdGhlbiBXT1JLRElSPS9hcHAKZWxpZiBbIC1kIC90ZXN0YmVkIF07IHRoZW4gV09SS0RJUj0vdGVzdGJlZAplbHNlIFdPUktESVI9LzsgZmkKY2QgIiRXT1JLRElSIgpTWVNQUk9NUFQ9JChjYXQgL3RtcC9jbGF1ZGVfc3lzdGVtX3Byb21wdC50eHQpCmNsYXVkZSAtLWFwcGVuZC1zeXN0ZW0tcHJvbXB0ICIkU1lTUFJPTVBUIiAtLWRhbmdlcm91c2x5LXNraXAtcGVybWlzc2lvbnMgLS12ZXJib3NlIC0tb3V0cHV0LWZvcm1hdCBzdHJlYW0tanNvbiAtcCAnCiMjIENvZGUgdG8gQW5hbHl6ZQoKYGBgCiciJyInQWNjb3VudEF1dGhlbnRpY2F0b3IvYWNjb3VudEF1dGhlbnRpY2F0b3Ivc3JjL21haW4vamF2YS9jb20vdWRpbmljL2FjY291bnRzX2F1dGhlbnRpY2F0b3JfZXhhbXBsZS9hdXRoZW50aWNhdGlvbi9BY2NvdW50R2VuZXJhbC5qYXZhJyInIicKOnBhY2thZ2UgY29tLnVkaW5pYy5hY2NvdW50c19hdXRoZW50aWNhdG9yX2V4YW1wbGUuYXV0aGVudGljYXRpb247CgovKioKICogQ3JlYXRlZCB3aXRoIEludGVsbGlKIElERUEuCiAqIFVzZXI6IFVkaW5pCiAqIERhdGU6IDIwLzAzLzEzCiAqIFRpbWU6IDE4OjExCiAqLwpwdWJsaWMgY2xhc3MgQWNjb3VudEdlbmVyYWwgewoKICAgIC8qKgogICAgICogQWNjb3VudCB0eXBlIGlkCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIEFDQ09VTlRfVFlQRSA9ICJjb20udWRpbmljLmF1dGhfZXhhbXBsZSI7CgogICAgLyoqCiAgICAgKiBBY2NvdW50IG5hbWUKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgQUNDT1VOVF9OQU1FID0gIlVkaW5pYyI7CgogICAgLyoqCiAgICAgKiBBdXRoIHRva2VuIHR5cGVzCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIEFVVEhUT0tFTl9UWVBFX1JFQURfT05MWSA9ICJSZWFkIG9ubHkiOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgQVVUSFRPS0VOX1RZUEVfUkVBRF9PTkxZX0xBQkVMID0gIlJlYWQgb25seSBhY2Nlc3MgdG8gYW4gVWRpbmljIGFjY291bnQiOwoKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIEFVVEhUT0tFTl9UWVBFX0ZVTExfQUNDRVNTID0gIkZ1bGwgYWNjZXNzIjsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIEFVVEhUT0tFTl9UWVBFX0ZVTExfQUNDRVNTX0xBQkVMID0gIkZ1bGwgYWNjZXNzIHRvIGFuIFVkaW5pYyBhY2NvdW50IjsKCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFNlcnZlckF1dGhlbnRpY2F0ZSBzU2VydmVyQXV0aGVudGljYXRlID0gbmV3IFBhcnNlQ29tU2VydmVyQXV0aGVudGljYXRlKCk7Cn0KCiciJyInQWNjb3VudEF1dGhlbnRpY2F0b3IvYWNjb3VudEF1dGhlbnRpY2F0b3Ivc3JjL21haW4vamF2YS9jb20vdWRpbmljL2FjY291bnRzX2F1dGhlbnRpY2F0b3JfZXhhbXBsZS9hdXRoZW50aWNhdGlvbi9VZGluaWNBdXRoZW50aWNhdG9yLmphdmEnIiciJwo6cGFja2FnZSBjb20udWRpbmljLmFjY291bnRzX2F1dGhlbnRpY2F0b3JfZXhhbXBsZS5hdXRoZW50aWNhdGlvbjsKCmltcG9ydCBhbmRyb2lkLmFjY291bnRzLio7CmltcG9ydCBhbmRyb2lkLmNvbnRlbnQuQ29udGV4dDsKaW1wb3J0IGFuZHJvaWQuY29udGVudC5JbnRlbnQ7CmltcG9ydCBhbmRyb2lkLm9zLkJ1bmRsZTsKaW1wb3J0IGFuZHJvaWQudGV4dC5UZXh0VXRpbHM7CmltcG9ydCBhbmRyb2lkLnV0aWwuTG9nOwoKaW1wb3J0IHN0YXRpYyBhbmRyb2lkLmFjY291bnRzLkFjY291bnRNYW5hZ2VyLktFWV9CT09MRUFOX1JFU1VMVDsKaW1wb3J0IHN0YXRpYyBjb20udWRpbmljLmFjY291bnRzX2F1dGhlbnRpY2F0b3JfZXhhbXBsZS5hdXRoZW50aWNhdGlvbi5BY2NvdW50R2VuZXJhbC4qOwoKLyoqCiAqIENyZWF0ZWQgd2l0aCBJbnRlbGxpSiBJREVBLgogKiBVc2VyOiBVZGluaQogKiBEYXRlOiAxOS8wMy8xMwogKiBUaW1lOiAxODo1OAogKi8KcHVibGljIGNsYXNzIFVkaW5pY0F1dGhlbnRpY2F0b3IgZXh0ZW5kcyBBYnN0cmFjdEFjY291bnRBdXRoZW50aWNhdG9yIHsKCiAgICBwcml2YXRlIFN0cmluZyBUQUcgPSAiVWRpbmljQXV0aGVudGljYXRvciI7CiAgICBwcml2YXRlIGZpbmFsIENvbnRleHQgbUNvbnRleHQ7CgogICAgcHVibGljIFVkaW5pY0F1dGhlbnRpY2F0b3IoQ29udGV4dCBjb250ZXh0KSB7CiAgICAgICAgc3VwZXIoY29udGV4dCk7CgogICAgICAgIC8vIEkgaGF0ZSB5b3UhIEdvb2dsZSAtIHNldCBtQ29udGV4dCBhcyBwcm90ZWN0ZWQhCiAgICAgICAgdGhpcy5tQ29udGV4dCA9IGNvbnRleHQ7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgQnVuZGxlIGFkZEFjY291bnQoQWNjb3VudEF1dGhlbnRpY2F0b3JSZXNwb25zZSByZXNwb25zZSwgU3RyaW5nIGFjY291bnRUeXBlLCBTdHJpbmcgYXV0aFRva2VuVHlwZSwgU3RyaW5nW10gcmVxdWlyZWRGZWF0dXJlcywgQnVuZGxlIG9wdGlvbnMpIHRocm93cyBOZXR3b3JrRXJyb3JFeGNlcHRpb24gewogICAgICAgIExvZy5kKCJ1ZGluaWMiLCBUQUcgKyAiPiBhZGRBY2NvdW50Iik7CgogICAgICAgIGZpbmFsIEludGVudCBpbnRlbnQgPSBuZXcgSW50ZW50KG1Db250ZXh0LCBBdXRoZW50aWNhdG9yQWN0aXZpdHkuY2xhc3MpOwogICAgICAgIGludGVudC5wdXRFeHRyYShBdXRoZW50aWNhdG9yQWN0aXZpdHkuQVJHX0FDQ09VTlRfVFlQRSwgYWNjb3VudFR5cGUpOwogICAgICAgIGludGVudC5wdXRFeHRyYShBdXRoZW50aWNhdG9yQWN0aXZpdHkuQVJHX0FVVEhfVFlQRSwgYXV0aFRva2VuVHlwZSk7CiAgICAgICAgaW50ZW50LnB1dEV4dHJhKEF1dGhlbnRpY2F0b3JBY3Rpdml0eS5BUkdfSVNfQURESU5HX05FV19BQ0NPVU5ULCB0cnVlKTsKICAgICAgICBpbnRlbnQucHV0RXh0cmEoQWNjb3VudE1hbmFnZXIuS0VZX0FDQ09VTlRfQVVUSEVOVElDQVRPUl9SRVNQT05TRSwgcmVzcG9uc2UpOwoKICAgICAgICBmaW5hbCBCdW5kbGUgYnVuZGxlID0gbmV3IEJ1bmRsZSgpOwogICAgICAgIGJ1bmRsZS5wdXRQYXJjZWxhYmxlKEFjY291bnRNYW5hZ2VyLktFWV9JTlRFTlQsIGludGVudCk7CiAgICAgICAgcmV0dXJuIGJ1bmRsZTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBCdW5kbGUgZ2V0QXV0aFRva2VuKEFjY291bnRBdXRoZW50aWNhdG9yUmVzcG9uc2UgcmVzcG9uc2UsIEFjY291bnQgYWNjb3VudCwgU3RyaW5nIGF1dGhUb2tlblR5cGUsIEJ1bmRsZSBvcHRpb25zKSB0aHJvd3MgTmV0d29ya0Vycm9yRXhjZXB0aW9uIHsKCiAgICAgICAgTG9nLmQoInVkaW5pYyIsIFRBRyArICI+IGdldEF1dGhUb2tlbiIpOwoKICAgICAgICAvLyBJZiB0aGUgY2FsbGVyIHJlcXVlc3RlZCBhbiBhdXRoVG9rZW4gdHlwZSB3ZSBkb24nIiciJ3Qgc3VwcG9ydCwgdGhlbgogICAgICAgIC8vIHJldHVybiBhbiBlcnJvcgogICAgICAgIGlmICghYXV0aFRva2VuVHlwZS5lcXVhbHMoQWNjb3VudEdlbmVyYWwuQVVUSFRPS0VOX1RZUEVfUkVBRF9PTkxZKSAmJiAhYXV0aFRva2VuVHlwZS5lcXVhbHMoQWNjb3VudEdlbmVyYWwuQVVUSFRPS0VOX1RZUEVfRlVMTF9BQ0NFU1MpKSB7CiAgICAgICAgICAgIGZpbmFsIEJ1bmRsZSByZXN1bHQgPSBuZXcgQnVuZGxlKCk7CiAgICAgICAgICAgIHJlc3VsdC5wdXRTdHJpbmcoQWNjb3VudE1hbmFnZXIuS0VZX0VSUk9SX01FU1NBR0UsICJpbnZhbGlkIGF1dGhUb2tlblR5cGUiKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CgogICAgICAgIC8vIEV4dHJhY3QgdGhlIHVzZXJuYW1lIGFuZCBwYXNzd29yZCBmcm9tIHRoZSBBY2NvdW50IE1hbmFnZXIsIGFuZCBhc2sKICAgICAgICAvLyB0aGUgc2VydmVyIGZvciBhbiBhcHByb3ByaWF0ZSBBdXRoVG9rZW4uCiAgICAgICAgZmluYWwgQWNjb3VudE1hbmFnZXIgYW0gPSBBY2NvdW50TWFuYWdlci5nZXQobUNvbnRleHQpOwoKICAgICAgICBTdHJpbmcgYXV0aFRva2VuID0gYW0ucGVla0F1dGhUb2tlbihhY2NvdW50LCBhdXRoVG9rZW5UeXBlKTsKCiAgICAgICAgTG9nLmQoInVkaW5pYyIsIFRBRyArICI+IHBlZWtBdXRoVG9rZW4gcmV0dXJuZWQgLSAiICsgYXV0aFRva2VuKTsKCiAgICAgICAgLy8gTGV0cyBnaXZlIGFub3RoZXIgdHJ5IHRvIGF1dGhlbnRpY2F0ZSB0aGUgdXNlcgogICAgICAgIGlmIChUZXh0VXRpbHMuaXNFbXB0eShhdXRoVG9rZW4pKSB7CiAgICAgICAgICAgIGZpbmFsIFN0cmluZyBwYXNzd29yZCA9IGFtLmdldFBhc3N3b3JkKGFjY291bnQpOwogICAgICAgICAgICBpZiAocGFzc3dvcmQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBMb2cuZCgidWRpbmljIiwgVEFHICsgIj4gcmUtYXV0aGVudGljYXRpbmcgd2l0aCB0aGUgZXhpc3RpbmcgcGFzc3dvcmQiKTsKICAgICAgICAgICAgICAgICAgICBhdXRoVG9rZW4gPSBzU2VydmVyQXV0aGVudGljYXRlLnVzZXJTaWduSW4oYWNjb3VudC5uYW1lLCBwYXNzd29yZCwgYXV0aFRva2VuVHlwZSk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgICAgIGUucHJpbnRTdGFja1RyYWNlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIElmIHdlIGdldCBhbiBhdXRoVG9rZW4gLSB3ZSByZXR1cm4gaXQKICAgICAgICBpZiAoIVRleHRVdGlscy5pc0VtcHR5KGF1dGhUb2tlbikpIHsKICAgICAgICAgICAgZmluYWwgQnVuZGxlIHJlc3VsdCA9IG5ldyBCdW5kbGUoKTsKICAgICAgICAgICAgcmVzdWx0LnB1dFN0cmluZyhBY2NvdW50TWFuYWdlci5LRVlfQUNDT1VOVF9OQU1FLCBhY2NvdW50Lm5hbWUpOwogICAgICAgICAgICByZXN1bHQucHV0U3RyaW5nKEFjY291bnRNYW5hZ2VyLktFWV9BQ0NPVU5UX1RZUEUsIGFjY291bnQudHlwZSk7CiAgICAgICAgICAgIHJlc3VsdC5wdXRTdHJpbmcoQWNjb3VudE1hbmFnZXIuS0VZX0FVVEhUT0tFTiwgYXV0aFRva2VuKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CgogICAgICAgIC8vIElmIHdlIGdldCBoZXJlLCB0aGVuIHdlIGNvdWxkbiciJyIndCBhY2Nlc3MgdGhlIHVzZXInIiciJ3MgcGFzc3dvcmQgLSBzbyB3ZQogICAgICAgIC8vIG5lZWQgdG8gcmUtcHJvbXB0IHRoZW0gZm9yIHRoZWlyIGNyZWRlbnRpYWxzLiBXZSBkbyB0aGF0IGJ5IGNyZWF0aW5nCiAgICAgICAgLy8gYW4gaW50ZW50IHRvIGRpc3BsYXkgb3VyIEF1dGhlbnRpY2F0b3JBY3Rpdml0eS4KICAgICAgICBmaW5hbCBJbnRlbnQgaW50ZW50ID0gbmV3IEludGVudChtQ29udGV4dCwgQXV0aGVudGljYXRvckFjdGl2aXR5LmNsYXNzKTsKICAgICAgICBpbnRlbnQucHV0RXh0cmEoQWNjb3VudE1hbmFnZXIuS0VZX0FDQ09VTlRfQVVUSEVOVElDQVRPUl9SRVNQT05TRSwgcmVzcG9uc2UpOwogICAgICAgIGludGVudC5wdXRFeHRyYShBdXRoZW50aWNhdG9yQWN0aXZpdHkuQVJHX0FDQ09VTlRfVFlQRSwgYWNjb3VudC50eXBlKTsKICAgICAgICBpbnRlbnQucHV0RXh0cmEoQXV0aGVudGljYXRvckFjdGl2aXR5LkFSR19BVVRIX1RZUEUsIGF1dGhUb2tlblR5cGUpOwogICAgICAgIGludGVudC5wdXRFeHRyYShBdXRoZW50aWNhdG9yQWN0aXZpdHkuQVJHX0FDQ09VTlRfTkFNRSwgYWNjb3VudC5uYW1lKTsKICAgICAgICBmaW5hbCBCdW5kbGUgYnVuZGxlID0gbmV3IEJ1bmRsZSgpOwogICAgICAgIGJ1bmRsZS5wdXRQYXJjZWxhYmxlKEFjY291bnRNYW5hZ2VyLktFWV9JTlRFTlQsIGludGVudCk7CiAgICAgICAgcmV0dXJuIGJ1bmRsZTsKICAgIH0KCgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgU3RyaW5nIGdldEF1dGhUb2tlbkxhYmVsKFN0cmluZyBhdXRoVG9rZW5UeXBlKSB7CiAgICAgICAgaWYgKEFVVEhUT0tFTl9UWVBFX0ZVTExfQUNDRVNTLmVxdWFscyhhdXRoVG9rZW5UeXBlKSkKICAgICAgICAgICAgcmV0dXJuIEFVVEhUT0tFTl9UWVBFX0ZVTExfQUNDRVNTX0xBQkVMOwogICAgICAgIGVsc2UgaWYgKEFVVEhUT0tFTl9UWVBFX1JFQURfT05MWS5lcXVhbHMoYXV0aFRva2VuVHlwZSkpCiAgICAgICAgICAgIHJldHVybiBBVVRIVE9LRU5fVFlQRV9SRUFEX09OTFlfTEFCRUw7CiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4gYXV0aFRva2VuVHlwZSArICIgKExhYmVsKSI7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgQnVuZGxlIGhhc0ZlYXR1cmVzKEFjY291bnRBdXRoZW50aWNhdG9yUmVzcG9uc2UgcmVzcG9uc2UsIEFjY291bnQgYWNjb3VudCwgU3RyaW5nW10gZmVhdHVyZXMpIHRocm93cyBOZXR3b3JrRXJyb3JFeGNlcHRpb24gewogICAgICAgIGZpbmFsIEJ1bmRsZSByZXN1bHQgPSBuZXcgQnVuZGxlKCk7CiAgICAgICAgcmVzdWx0LnB1dEJvb2xlYW4oS0VZX0JPT0xFQU5fUkVTVUxULCBmYWxzZSk7CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBCdW5kbGUgZWRpdFByb3BlcnRpZXMoQWNjb3VudEF1dGhlbnRpY2F0b3JSZXNwb25zZSByZXNwb25zZSwgU3RyaW5nIGFjY291bnRUeXBlKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgQnVuZGxlIGNvbmZpcm1DcmVkZW50aWFscyhBY2NvdW50QXV0aGVudGljYXRvclJlc3BvbnNlIHJlc3BvbnNlLCBBY2NvdW50IGFjY291bnQsIEJ1bmRsZSBvcHRpb25zKSB0aHJvd3MgTmV0d29ya0Vycm9yRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBCdW5kbGUgdXBkYXRlQ3JlZGVudGlhbHMoQWNjb3VudEF1dGhlbnRpY2F0b3JSZXNwb25zZSByZXNwb25zZSwgQWNjb3VudCBhY2NvdW50LCBTdHJpbmcgYXV0aFRva2VuVHlwZSwgQnVuZGxlIG9wdGlvbnMpIHRocm93cyBOZXR3b3JrRXJyb3JFeGNlcHRpb24gewogICAgICAgIHJldHVybiBudWxsOwogICAgfQp9CgoKYGBgCgojIERlcGVuZGVuY3kgUmVjb2duaXRpb24gVGFzawoKIyMgUHJvYmxlbSBTdGF0ZW1lbnQKCgoKIyMgVGFzayBEZXNjcmlwdGlvbgoKWW91ciB0YXNrIGlzIHRvIGlkZW50aWZ5IGFsbCBkZXBlbmRlbmNpZXMgaW4gdGhlIGdpdmVuIGNvZGUuIEFuYWx5emUgdGhlIGNvZGViYXNlIGFuZCBkZXRlcm1pbmUgd2hpY2ggZXh0ZXJuYWwgbGlicmFyaWVzLCBtb2R1bGVzLCBvciBwYWNrYWdlcyBhcmUgYmVpbmcgdXNlZC4KCiMjIFJlcG9zaXRvcnkgSW5mb3JtYXRpb24KCi0gKipSZXBvc2l0b3J5Kio6IEFjY291bnRBdXRoZW50aWNhdG9yCi0gKipMYW5ndWFnZSoqOiBqYXZhCi0gKipGaWxlIFBhdGgqKjogTi9BCgojIyBPdXRwdXQgRm9ybWF0CgpXcml0ZSB5b3VyIGFuc3dlciB0byBgL3dvcmtzcGFjZS9zdWJtaXNzaW9uLmpzb25gIGFzIGEgSlNPTiBhcnJheSBvZiBkZXBlbmRlbmN5IG5hbWVzOgoKYGBganNvbgpbImRlcGVuZGVuY3kxIiwgImRlcGVuZGVuY3kyIiwgImRlcGVuZGVuY3kzIl0KYGBgCgojIyMgUmVxdWlyZW1lbnRzOgoKMS4gSW5jbHVkZSBvbmx5IGRpcmVjdCBkZXBlbmRlbmNpZXMgKG5vdCB0cmFuc2l0aXZlIGRlcGVuZGVuY2llcykKMi4gVXNlIHRoZSBleGFjdCBwYWNrYWdlL21vZHVsZSBuYW1lcyBhcyB0aGV5IGFwcGVhciBpbiBpbXBvcnQgc3RhdGVtZW50cwozLiBPcmRlciBkb2VzbiciJyIndCBtYXR0ZXIsIGJ1dCBhdm9pZCBkdXBsaWNhdGVzCjQuIFJldHVybiBhbiBlbXB0eSBhcnJheSBgW11gIGlmIHRoZXJlIGFyZSBubyBkZXBlbmRlbmNpZXMKCiMjIyBFeGFtcGxlIE91dHB1dDoKCmBgYGpzb24KWyJudW1weSIsICJwYW5kYXMiLCAibWF0cGxvdGxpYiJdCmBgYAoKIyMgRXZhbHVhdGlvbgoKWW91ciBzdWJtaXNzaW9uIHdpbGwgYmUgZXZhbHVhdGVkIHVzaW5nIGV4YWN0IG1hdGNoLiBZb3UgbXVzdCBpZGVudGlmeSBhbGwgZGVwZW5kZW5jaWVzIGNvcnJlY3RseSB0byByZWNlaXZlIGZ1bGwgY3JlZGl0LgoKKipTY29yaW5nKio6IDEuMCBpZiBhbGwgZGVwZW5kZW5jaWVzIG1hdGNoIGV4YWN0bHksIDAuMCBvdGhlcndpc2UuCgojIyBUaXBzCgotIExvb2sgZm9yIGltcG9ydCBzdGF0ZW1lbnRzLCByZXF1aXJlIHN0YXRlbWVudHMsIG9yIHBhY2thZ2UgZGVjbGFyYXRpb25zIGRlcGVuZGluZyBvbiB0aGUgbGFuZ3VhZ2UKLSBDb25zaWRlciBib3RoIHN0YW5kYXJkIGxpYnJhcnkgYW5kIHRoaXJkLXBhcnR5IGRlcGVuZGVuY2llcwotIFBheSBhdHRlbnRpb24gdG8gYWxpYXNlZCBpbXBvcnRzIChlLmcuLCBgaW1wb3J0IG51bXB5IGFzIG5wYCAtPiAibnVtcHkiKQotIEZvciBQeXRob246IGNoZWNrIGJvdGggYGltcG9ydCBYYCBhbmQgYGZyb20gWCBpbXBvcnQgWWAgc3RhdGVtZW50cwonIC0tYWxsb3dlZFRvb2xzIEJhc2ggRWRpdCBXcml0ZSBSZWFkIEdsb2IgR3JlcCBMUyBXZWJGZXRjaCBOb3RlYm9va0VkaXQgTm90ZWJvb2tSZWFkIFRvZG9SZWFkIFRvZG9Xcml0ZSBBZ2VudCBTa2lsbCBTbGFzaENvbW1hbmQgVGFzayBXZWJTZWFyY2ggMj4mMSA8L2Rldi9udWxsIHwgdGVlIC9sb2dzL2FnZW50L2NsYXVkZS1jb2RlLnR4dAo=' | base64 -d > /tmp/claude_run.sh && chmod +x /tmp/claude_run.sh && su claude -s /bin/bash /tmp/claude_run.sh ; chmod -R a+rX /logs 2>/dev/null || true