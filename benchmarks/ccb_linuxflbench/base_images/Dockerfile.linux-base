FROM gcc:13-bookworm

# Parameterized kernel version
ARG KERNEL_COMMIT
ARG KERNEL_VERSION_LABEL

LABEL org.codecontextbench.kernel_version="${KERNEL_VERSION_LABEL}"
LABEL org.codecontextbench.kernel_commit="${KERNEL_COMMIT}"
LABEL org.codecontextbench.benchmark="ccb_linuxflbench"

# Install common tools
RUN apt-get update && apt-get install -y \
    git \
    curl \
    ripgrep \
    && rm -rf /var/lib/apt/lists/*

# Install Node.js (for Claude Code CLI)
RUN if ! command -v node &> /dev/null; then \
    curl -fsSL https://deb.nodesource.com/setup_20.x | bash - && \
    apt-get install -y nodejs; \
    fi

# Install Claude Code CLI
RUN npm install -g @anthropic-ai/claude-code

# Clone Linux kernel at pinned commit (partial clone for speed)
RUN git clone --filter=blob:none https://github.com/torvalds/linux.git /workspace && \
    cd /workspace && \
    git checkout ${KERNEL_COMMIT}

# Create standard directories
RUN mkdir -p /workspace/tests /logs/verifier

WORKDIR /workspace
