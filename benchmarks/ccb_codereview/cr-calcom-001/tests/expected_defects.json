[
  {
    "id": "defect-1",
    "file": "packages/features/feature-opt-in/services/FeatureOptInService.ts",
    "line_start": 160,
    "line_end": 162,
    "type": "bug",
    "severity": "critical",
    "description": "Filter condition inverted in listFeaturesForUser — uses !state.globalEnabled instead of state.globalEnabled, causing only globally disabled features to be returned while hiding all enabled features from users."
  },
  {
    "id": "defect-2",
    "file": "packages/features/feature-opt-in/config.ts",
    "line_start": 72,
    "line_end": 75,
    "type": "bug",
    "severity": "high",
    "description": "Missing scope fallback in isFeatureAllowedForScope — the !config.scope check was removed, so features without an explicit scope array (which should default to all scopes) are now rejected for every scope."
  },
  {
    "id": "defect-3",
    "file": "packages/trpc/server/routers/viewer/featureOptIn/_router.ts",
    "line_start": 95,
    "line_end": 105,
    "type": "bug",
    "severity": "high",
    "description": "Missing isOptInFeature validation in setUserState mutation — the slug allowlist check was removed, allowing any arbitrary feature slug to be set by users, bypassing the opt-in feature guard."
  },
  {
    "id": "defect-4",
    "file": "packages/features/feature-opt-in/services/FeatureOptInService.ts",
    "line_start": 138,
    "line_end": 140,
    "type": "violation",
    "severity": "medium",
    "description": "Per-feature policy configuration ignored — the policy is hardcoded to 'permissive' instead of being read from getOptInFeatureConfig, causing all features to use permissive evaluation regardless of their configured policy."
  }
]
