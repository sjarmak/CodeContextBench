'oracle-r2dbc/src/main/java/oracle/r2dbc/impl/SqlTypeMap.java'
:
package oracle.r2dbc.impl;

import io.r2dbc.spi.R2dbcType;
import io.r2dbc.spi.Type;
import oracle.jdbc.OracleType;
import oracle.r2dbc.OracleR2dbcObject;
import oracle.r2dbc.OracleR2dbcTypes;
import oracle.sql.VECTOR;
import oracle.sql.json.OracleJsonObject;

import java.math.BigDecimal;
import java.math.BigInteger;
import java.nio.ByteBuffer;
import java.sql.JDBCType;
import java.sql.RowId;
import java.sql.SQLException;
import java.sql.SQLType;
import java.sql.Types;
import java.time.Duration;
import java.time.LocalDate;
import java.time.LocalDateTime;
import java.time.LocalTime;
import java.time.OffsetDateTime;
import java.time.OffsetTime;
import java.time.Period;
import java.util.Map;
import java.util.stream.Collectors;

import static java.util.Map.entry;


final class SqlTypeMap {


  private static final Map<SQLType, Type> JDBC_TO_R2DBC_TYPE_MAP =
    Map.ofEntries(
      entry(JDBCType.ARRAY, R2dbcType.COLLECTION),
      entry(JDBCType.BIGINT, R2dbcType.BIGINT),
      entry(JDBCType.BINARY, R2dbcType.BINARY),
      entry(OracleType.BINARY_DOUBLE, OracleR2dbcTypes.BINARY_DOUBLE),
      entry(OracleType.BINARY_FLOAT, OracleR2dbcTypes.BINARY_FLOAT),
      entry(JDBCType.BLOB, R2dbcType.BLOB),
      entry(JDBCType.BOOLEAN, R2dbcType.BOOLEAN),
      entry(JDBCType.CHAR, R2dbcType.CHAR),
      entry(JDBCType.CLOB, R2dbcType.CLOB),
      entry(JDBCType.DATE, R2dbcType.DATE),
      entry(JDBCType.DECIMAL, R2dbcType.DECIMAL),
      entry(JDBCType.DOUBLE, R2dbcType.DOUBLE),
      entry(JDBCType.FLOAT, R2dbcType.FLOAT),
      entry(JDBCType.INTEGER, R2dbcType.INTEGER),
      entry(
        OracleType.INTERVAL_DAY_TO_SECOND,
        OracleR2dbcTypes.INTERVAL_DAY_TO_SECOND),
      entry(
        OracleType.INTERVAL_YEAR_TO_MONTH,
        OracleR2dbcTypes.INTERVAL_YEAR_TO_MONTH),
      entry(OracleType.JSON, OracleR2dbcTypes.JSON),
      entry(JDBCType.LONGVARBINARY, OracleR2dbcTypes.LONG_RAW),
      entry(JDBCType.LONGVARCHAR, OracleR2dbcTypes.LONG),
      entry(JDBCType.NCHAR, R2dbcType.NCHAR),
      entry(JDBCType.NCLOB, R2dbcType.NCLOB),
      entry(JDBCType.NUMERIC, R2dbcType.NUMERIC),
      entry(JDBCType.NVARCHAR, R2dbcType.NVARCHAR),
      entry(JDBCType.REAL, R2dbcType.REAL),
      entry(JDBCType.REF_CURSOR, OracleR2dbcTypes.REF_CURSOR),
      entry(JDBCType.ROWID, OracleR2dbcTypes.ROWID),
      entry(JDBCType.SMALLINT, R2dbcType.SMALLINT),
      entry(JDBCType.TIME, R2dbcType.TIME),
      entry(JDBCType.TIME_WITH_TIMEZONE, R2dbcType.TIME_WITH_TIME_ZONE),
      entry(JDBCType.TIMESTAMP, R2dbcType.TIMESTAMP),
      entry(
        OracleType.TIMESTAMP_WITH_LOCAL_TIME_ZONE,
        OracleR2dbcTypes.TIMESTAMP_WITH_LOCAL_TIME_ZONE),
      entry(


        OracleType.TIMESTAMP_WITH_TIME_ZONE,
        R2dbcType.TIMESTAMP_WITH_TIME_ZONE),
      entry(JDBCType.TINYINT, R2dbcType.TINYINT),
      entry(JDBCType.VARBINARY, R2dbcType.VARBINARY),
      entry(JDBCType.VARCHAR, R2dbcType.VARCHAR),
      entry(OracleType.VECTOR, OracleR2dbcTypes.VECTOR)
    );


  private static final Map<Type, SQLType> R2DBC_TO_JDBC_TYPE_MAP =

    JDBC_TO_R2DBC_TYPE_MAP.entrySet().stream()
      .collect(Collectors.toMap(Map.Entry::getValue, Map.Entry::getKey));


  private static final Map<Class<?>, SQLType> JAVA_TO_SQL_TYPE_MAP =
    Map.ofEntries(

      entry(String.class, JDBCType.VARCHAR),
      entry(Boolean.class, JDBCType.BOOLEAN),
      entry(ByteBuffer.class, JDBCType.VARBINARY),
      entry(Integer.class, JDBCType.INTEGER),
      entry(Byte.class, JDBCType.TINYINT),
      entry(Short.class, JDBCType.SMALLINT),
      entry(Long.class, JDBCType.BIGINT),
      entry(BigDecimal.class, JDBCType.NUMERIC),
      entry(Float.class, JDBCType.REAL),
      entry(Double.class, JDBCType.DOUBLE),
      entry(LocalDate.class, JDBCType.DATE),
      entry(LocalTime.class, JDBCType.TIME),
      entry(OffsetTime.class, JDBCType.TIME_WITH_TIMEZONE),
      entry(LocalDateTime.class, JDBCType.TIMESTAMP),
      entry(OffsetDateTime.class, JDBCType.TIMESTAMP_WITH_TIMEZONE),
      entry(io.r2dbc.spi.Blob.class, JDBCType.BLOB),
      entry(io.r2dbc.spi.Clob.class, JDBCType.CLOB),
      entry(Object[].class, JDBCType.ARRAY),







      entry(byte[].class, JDBCType.VARBINARY),
      entry(BigInteger.class, JDBCType.BIGINT),
      entry(java.sql.Date.class, JDBCType.DATE),
      entry(java.sql.Time.class, JDBCType.TIME),
      entry(java.sql.Timestamp.class, JDBCType.TIMESTAMP),
      entry(java.sql.Array.class, JDBCType.ARRAY),
      entry(java.sql.Blob.class, JDBCType.BLOB),
      entry(java.sql.Clob.class, JDBCType.CLOB),
      entry(java.sql.Struct.class, JDBCType.STRUCT),
      entry(java.sql.Ref.class, JDBCType.REF),
      entry(java.net.URL.class, JDBCType.DATALINK),
      entry(java.sql.RowId.class, JDBCType.ROWID),
      entry(java.sql.NClob.class, JDBCType.NCLOB),
      entry(java.sql.SQLXML.class, JDBCType.SQLXML),
      entry(java.util.Calendar.class, JDBCType.TIMESTAMP),
      entry(java.util.Date.class, JDBCType.TIMESTAMP),


      entry(Duration.class, OracleType.INTERVAL_DAY_TO_SECOND),
      entry(Period.class, OracleType.INTERVAL_YEAR_TO_MONTH),
      entry(OracleJsonObject.class, OracleType.JSON),




      entry(boolean[].class, JDBCType.ARRAY),


      entry(short[].class, JDBCType.ARRAY),
      entry(int[].class, JDBCType.ARRAY),
      entry(long[].class, JDBCType.ARRAY),
      entry(float[].class, JDBCType.ARRAY),
      entry(double[].class, JDBCType.ARRAY),



      entry(Map.class, JDBCType.STRUCT),
      entry(OracleR2dbcObject.class, JDBCType.STRUCT),


      entry(VECTOR.class, OracleType.VECTOR)
    );


  static Type toR2dbcType(SQLType jdbcType) {
    return JDBC_TO_R2DBC_TYPE_MAP.get(jdbcType);
  }


  static Type toR2dbcType(int jdbcTypeNumber) {


    for (JDBCType jdbcType : JDBCType.values()) {
      Integer vendorTypeNumber = jdbcType.getVendorTypeNumber();

      if (vendorTypeNumber != null && vendorTypeNumber == jdbcTypeNumber)
        return toR2dbcType(jdbcType);
    }


    try {
      OracleType oracleType =
        oracle.jdbc.OracleType.toOracleType(jdbcTypeNumber);

      if (oracleType != null)
        return toR2dbcType(oracleType);
      else
        return null;
    }
    catch (SQLException typeNotFound) {

      return null;
    }
  }


  static SQLType toJdbcType(Type r2dbcType) {
    if (r2dbcType instanceof Type.InferredType)
      return toJdbcType(r2dbcType.getJavaType());
    else if (r2dbcType instanceof OracleR2dbcTypes.ArrayType)
      return JDBCType.ARRAY;
    else if (r2dbcType instanceof OracleR2dbcTypes.ObjectType)
      return JDBCType.STRUCT;
    else
      return R2DBC_TO_JDBC_TYPE_MAP.get(r2dbcType);
  }


  static SQLType toJdbcType(Class<?> javaType) {
    SQLType sqlType = JAVA_TO_SQL_TYPE_MAP.get(javaType);

    if (sqlType != null) {
      return sqlType;
    }
    else {

      return JAVA_TO_SQL_TYPE_MAP.entrySet()
        .stream()
        .filter(entry -> entry.getKey().isAssignableFrom(javaType))
        .map(Map.Entry::getValue)
        .findFirst()
        .orElse(null);
    }
  }
}
