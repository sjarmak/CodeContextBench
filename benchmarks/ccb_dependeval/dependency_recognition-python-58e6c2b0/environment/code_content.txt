'MLOS/mlos_bench/mlos_bench/services/types/host_ops_type.py'
:





from typing import Tuple, Protocol, runtime_checkable, TYPE_CHECKING

if TYPE_CHECKING:
    from mlos_bench.environments.status import Status


@runtime_checkable
class SupportsHostOps(Protocol):


    def start_host(self, params: dict) -> Tuple["Status", dict]:


    def stop_host(self, params: dict, force: bool = False) -> Tuple["Status", dict]:


    def restart_host(self, params: dict, force: bool = False) -> Tuple["Status", dict]:


    def wait_host_operation(self, params: dict) -> Tuple["Status", dict]:
        """
        Waits for a pending operation on a Host/VM to resolve to SUCCEEDED or FAILED.
        Return TIMED_OUT when timing out.

        Parameters
        ----------
        params: dict
            Flat dictionary of (key, value) pairs of tunable parameters.
            Must have the "asyncResultsUrl" key to get the results.
            If the key is not present, return Status.PENDING.

        Returns
        -------
        result : (Status, dict)
            A pair of Status and result.
            Status is one of {PENDING, SUCCEEDED, FAILED, TIMED_OUT}
            Result is info on the operation runtime if SUCCEEDED, otherwise {}.

Cloud-based (configurable) SaaS environment.

    Cloud-based (configurable) SaaS environment.

        Create a new environment for (configurable) cloud-based SaaS instance.

        Parameters
        ----------
        name: str
            Human-readable name of the environment.
        config : dict
            Free-format dictionary that contains the benchmark environment
            configuration. Each config must have at least the "tunable_params"
            and the "const_args" sections.
        global_config : dict
            Free-format dictionary of global parameters (e.g., security credentials)
            to be mixed in into the "const_args" section of the local config.
        tunables : TunableGroups
            A collection of tunable parameters for *all* environments.
        service: Service
            An optional service object
            (e.g., providing methods to configure the remote service).
        """
        super().__init__(name=name, config=config, global_config=global_config,
                         tunables=tunables, service=service)

        assert self._service is not None and isinstance(self._service, SupportsHostOps), \
            "RemoteEnv requires a service that supports host operations"
        self._host_service: SupportsHostOps = self._service

        assert self._service is not None and isinstance(self._service, SupportsRemoteConfig), \
            "SaaSEnv requires a service that supports remote host configuration API"
        self._config_service: SupportsRemoteConfig = self._service

    def setup(self, tunables: TunableGroups, global_config: Optional[dict] = None) -> bool:

        _LOG.info("SaaS set up: %s :: %s", self, tunables)
        if not super().setup(tunables, global_config):
            return False

        (status, _) = self._config_service.configure(
            self._params, self._tunable_params.get_param_values())
        if not status.is_succeeded():
            return False

        (status, res) = self._config_service.is_config_pending(self._params)
        if not status.is_succeeded():
            return False


        if res.get('isConfigPendingRestart') or res.get('isConfigPendingReboot'):
            _LOG.info("Restarting: %s", self)
            (status, params) = self._host_service.restart_host(self._params)
            if status.is_pending():
                (status, _) = self._host_service.wait_host_operation(params)
            if not status.is_succeeded():
                return False

            _LOG.info("Wait to restart: %s", self)
            (status, params) = self._host_service.start_host(self._params)
            if status.is_pending():
                (status, _) = self._host_service.wait_host_operation(params)

        self._is_ready = status.is_succeeded()
        return self._is_ready

'MLOS/mlos_bench/mlos_bench/environments/remote/__init__.py'
:





from mlos_bench.environments.remote.host_env import HostEnv
from mlos_bench.environments.remote.network_env import NetworkEnv
from mlos_bench.environments.remote.os_env import OSEnv
from mlos_bench.environments.remote.remote_env import RemoteEnv
from mlos_bench.environments.remote.saas_env import SaaSEnv
from mlos_bench.environments.remote.vm_env import VMEnv

__all__ = [
    'HostEnv',
    'NetworkEnv',
    'OSEnv',
    'RemoteEnv',
    'SaaSEnv',
    'VMEnv',
]
