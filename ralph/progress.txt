## Codebase Patterns
- instruction.md files are shared across all configs (baseline, SG_base, SG_full). MCP instructions are added via the SG preamble in claude_baseline_agent.py, NOT in instruction.md
- __archived_invalid/ is the convention for moving invalid runs within their batch directory
- runs/official/archive/ is for moving entire superseded batch directories
- status_fingerprints.py FINGERPRINTS dict uses regex patterns; aggregate_status.py imports them
- check_infra.py uses section-based checks with PASS/WARN/FAIL output
- archive_run.py has dry-run by default, --execute to actually archive
- generate_manifest.py scans runs/official/ for result.json, skips archive/ and __archived_invalid/
- LargeRepo task.toml pre_fix_rev values: may be tags (v1.30.0) or branch names (main) — check instance_to_mirror.json for actual commit hashes
- configs/instance_to_mirror.json maps task IDs to Sourcegraph mirror repo names with commit suffixes
- RepoQA instructions at benchmarks/ccb_repoqa/tasks/*/instruction.md
- TAC instructions at benchmarks/ccb_tac/*/instruction.md (6 active tasks)
- LargeRepo instructions at benchmarks/ccb_largerepo/*/instruction.md (4 tasks)
- SWE-bench Pro gap-fill instructions at benchmarks/ccb_swebenchpro/tasks/*/instruction.md
- K8s Docs instructions at benchmarks/ccb_k8sdocs/*/instruction.md (5 tasks, 2 contaminated)
- PyTorch instructions at benchmarks/ccb_pytorch/sgt-*/instruction.md (25 tasks, only sgt-001 contaminated)
- .gitignore has `tasks/` and `ralph/` patterns — benchmark task files and ralph/ files need `git add -f`
- Edit tool edits can be silently reverted by linter hooks — always verify with `git diff --stat` and use Write (full overwrite) as fallback
- Always verify current branch with `git branch --show-current` before committing — hooks/tools can switch branches

## Progress

- QA Audit completed 2026-02-06: 28 issues (9 critical, 5 high, 6 medium, 8 low) → docs/QA_AUDIT_2026-02-06.md
- PRD created: tasks/prd-qa-audit-fixes.md (21 user stories) + ralph/prd.json (15 Ralph-executable stories)
- C9 (Deep Search polling failure) documented; DS stories moved to ralph-ds/
- No stories executed yet — all 15 pending

## 2026-02-06 - US-001
- Stripped all MCP/Sourcegraph references from 10 RepoQA instruction.md files
- Files changed: benchmarks/ccb_repoqa/tasks/*/instruction.md (all 10)
- Per file: removed "Use Sourcegraph MCP semantic search" step, "Sourcegraph MCP Tools You Should Use" section, "Use Sourcegraph MCP liberally" closing line
- Replaced step 2 with generic "Search the codebase" wording
- **Learnings for future iterations:**
  - The `tasks/` gitignore pattern matches at any depth — must use `git add -f` for benchmark task files
  - All 10 RepoQA files use identical template structure; batch edits via Python script are most reliable
  - The Edit tool can be fragile when making many parallel edits to files — Python scripts are more reliable for bulk changes
---

## 2026-02-06 - US-002
- Stripped all MCP/Sourcegraph references from 6 active TAC instruction.md files
- Files changed: benchmarks/ccb_tac/{tac-buffer-pool-manager,tac-dependency-change,tac-find-in-codebase-1,tac-find-in-codebase-2,tac-implement-hyperloglog,tac-write-unit-test}/instruction.md
- Per file: removed "**Why this benefits from MCP:**" bullet-list sections; removed MCP-advocacy Notes lines
- tac-find-in-codebase-1: also cleaned "Sourcegraph MCP excels at" from Description text and "Deep Search understands semantic queries" from Notes
- tac-find-in-codebase-2: also removed "Validates MCP advantage on git history search" note
- tac-write-unit-test: also removed "MCP helps find existing test patterns" note
- **Learnings for future iterations:**
  - Edit tool changes can be silently reverted by linter hooks — always verify with `git diff` before committing. Use Write tool (full file overwrite) when Edit gets reverted.
  - When switching branches, verify with `git branch --show-current` BEFORE committing — Write tool or hooks can silently switch branches
  - TAC has 8 directories but only 6 are active tasks (tac-copilot-arena-endpoint and tac-troubleshoot-dev-setup are not in the active set)
---

## 2026-02-06 - US-003
- Stripped all MCP/Sourcegraph references from 4 LargeRepo instruction.md files
- Files changed: benchmarks/ccb_largerepo/{big-code-k8s-001,big-code-servo-001,big-code-trt-001,big-code-vsc-001}/instruction.md
- Per file: removed "**Why this requires MCP:**" paragraph, "(use Sourcegraph MCP for broad search)" parenthetical from implementation steps, "**Why MCP Helps:**" footer line
- All task requirements and context preserved
- **Learnings for future iterations:**
  - LargeRepo files all use the same 3-location pattern for MCP refs: description paragraph, implementation step 1, and footer metadata
  - Branch switching can happen silently between `git branch --show-current` and `git commit` — always re-verify branch immediately before committing
  - The stash-checkout-pop workflow is needed to move between ralph branches since they have divergent file trees
---
