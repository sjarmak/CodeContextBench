## Codebase Patterns

### Harbor Task Format
- Each task lives in `benchmarks/ccb_{benchmark}/{task_name}/`
- Required files: task.toml, instruction.md, environment/Dockerfile, tests/test.sh
- Build context is `environment/` dir (NOT task root) — `docker.py:73: context_dir=str(self.environment_dir)`
- COPY paths in Dockerfile must be relative to `environment/`: `COPY inject_defects.sh` YES, `COPY environment/inject_defects.sh` NO
- Harbor uploads `tests/` directory to `/tests/` in container at runtime — do NOT COPY tests/ in Dockerfile
- task.toml verification command: use `/tests/test.sh` (Harbor upload path), NOT `/workspace/tests/test.sh`

### task.toml Format
```toml
[task]
name = "task-name-here"
language = "python"
difficulty = "medium"
time_limit_sec = 600

[task.metadata]
# Custom fields for governance
permitted_paths = ["service-a/"]
restricted_paths = ["service-b/"]
```

### Dockerfile Pattern (Python tasks)
```dockerfile
FROM python:3.11-slim
WORKDIR /workspace
# Copy workspace files from environment/ build context
COPY workspace/ /workspace/
# Install deps if needed
RUN pip install -r requirements.txt 2>/dev/null || true
```

### test.sh Pattern
```bash
#!/bin/bash
set -e
cd /workspace
# Check for expected output/changes
# Exit 0 = pass, non-zero = fail
```

### selected_benchmark_tasks.json Format
- Array of objects with: task_name, benchmark, repo, language, difficulty, mcp_benefit_score, selected (bool)
- New tasks should follow existing object structure
- benchmark field = "ccb_governance" for governance tasks

### Trajectory Analysis
- trajectory.json contains structured tool usage with tool names and parameters
- File access operations: Read (file_path param), Write (file_path), Edit (file_path), Glob (pattern)
- Extract file_path from tool call parameters to check against permitted/restricted lists

## Progress
