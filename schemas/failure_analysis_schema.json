{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Failure Analysis",
  "description": "Output schema for scripts/failure_analysis.py â€” per-task failure classification, context attribution, aggregate failure modes, and residual limitations.",
  "type": "object",
  "required": ["generated_at", "per_task", "aggregate", "context_summary", "residual_limitations", "failure_taxonomy"],
  "properties": {
    "generated_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of report generation."
    },
    "per_task": {
      "type": "array",
      "description": "Per-task failure records with classification and context attribution.",
      "items": {
        "$ref": "#/definitions/failed_task_record"
      }
    },
    "aggregate": {
      "type": "object",
      "description": "Counts per failure mode (sorted descending).",
      "additionalProperties": { "type": "integer" }
    },
    "context_summary": {
      "type": "object",
      "description": "Counts per context_impact label (sorted descending).",
      "additionalProperties": { "type": "integer" }
    },
    "residual_limitations": {
      "type": "array",
      "description": "Failure modes that persist even in SG_full config.",
      "items": {
        "$ref": "#/definitions/residual_limitation"
      }
    },
    "failure_taxonomy": {
      "type": "object",
      "description": "Definitions for all 6 failure modes.",
      "additionalProperties": {
        "$ref": "#/definitions/failure_mode_definition"
      }
    }
  },
  "definitions": {
    "failed_task_record": {
      "type": "object",
      "required": ["task_name", "suite", "config", "reward", "has_exception", "tool_call_count", "mcp_call_count", "failure_mode", "failure_detail", "context_impact"],
      "properties": {
        "task_name": { "type": "string", "description": "Task identifier (hash-stripped)." },
        "suite": { "type": "string", "description": "Benchmark suite." },
        "config": { "type": "string", "description": "Agent configuration." },
        "reward": { "type": ["number", "null"], "description": "Task reward (0.0 for failed tasks)." },
        "has_exception": { "type": "boolean", "description": "Whether the task had an exception." },
        "tool_call_count": { "type": "integer", "description": "Total tool calls." },
        "mcp_call_count": { "type": "integer", "description": "MCP (Sourcegraph) tool calls." },
        "error_fingerprint": {
          "type": ["object", "null"],
          "description": "Error fingerprint from status_fingerprints.py (null if no exception)."
        },
        "failure_mode": {
          "type": "string",
          "enum": ["context_insufficient", "context_misused", "implementation_error", "verification_mismatch", "infrastructure_failure", "scope_exceeded"],
          "description": "Classified failure mode."
        },
        "failure_detail": { "type": "string", "description": "Human-readable failure classification detail." },
        "context_impact": {
          "type": "string",
          "enum": ["context_resolved", "context_partial_help", "context_no_impact", "context_made_worse", "no_comparison"],
          "description": "Impact of context infrastructure on this failure."
        }
      }
    },
    "residual_limitation": {
      "type": "object",
      "required": ["failure_mode", "label", "count_in_sg_full", "description"],
      "properties": {
        "failure_mode": { "type": "string" },
        "label": { "type": "string", "description": "Human-readable label." },
        "count_in_sg_full": { "type": "integer", "description": "Number of SG_full tasks with this failure mode." },
        "description": { "type": "string" }
      }
    },
    "failure_mode_definition": {
      "type": "object",
      "required": ["id", "label", "description", "heuristic"],
      "properties": {
        "id": { "type": "string" },
        "label": { "type": "string" },
        "description": { "type": "string" },
        "heuristic": { "type": "string", "description": "Classification heuristic used." }
      }
    }
  },
  "examples": [
    {
      "generated_at": "2026-02-15T12:00:00+00:00",
      "per_task": [
        {
          "task_name": "example_task",
          "suite": "ccb_locobench",
          "config": "baseline",
          "reward": 0.0,
          "has_exception": false,
          "tool_call_count": 3,
          "mcp_call_count": 0,
          "error_fingerprint": null,
          "failure_mode": "context_insufficient",
          "failure_detail": "Agent made 2 search/read calls and 0 edits",
          "context_impact": "context_resolved"
        }
      ],
      "aggregate": {
        "context_misused": 55,
        "context_insufficient": 27,
        "scope_exceeded": 20,
        "implementation_error": 10,
        "infrastructure_failure": 5,
        "verification_mismatch": 2
      },
      "context_summary": {
        "context_no_impact": 76,
        "context_resolved": 12,
        "context_partial_help": 12,
        "context_made_worse": 10,
        "no_comparison": 9
      },
      "residual_limitations": [
        {
          "failure_mode": "context_misused",
          "label": "Context Misused",
          "count_in_sg_full": 14,
          "description": "Agent gathered context but edited wrong files or applied changes incorrectly."
        }
      ],
      "failure_taxonomy": {
        "context_insufficient": {
          "id": "context_insufficient",
          "label": "Insufficient Context",
          "description": "Agent lacked necessary codebase context to solve the task.",
          "heuristic": "Fewer than 5 search/read tool calls in baseline."
        }
      }
    }
  ]
}
