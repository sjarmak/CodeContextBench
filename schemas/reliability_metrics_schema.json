{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Reliability Metrics",
  "description": "Output schema for scripts/reliability_analysis.py â€” per-suite/config stats with bootstrap CI, cross-suite consistency, reliability floor, and failure clusters.",
  "type": "object",
  "required": ["generated_at", "per_suite_config", "cross_suite_consistency", "reliability_floor", "failure_clusters"],
  "properties": {
    "generated_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of report generation."
    },
    "per_suite_config": {
      "type": "object",
      "description": "Descriptive stats and CI grouped by (suite, config).",
      "additionalProperties": {
        "type": "object",
        "description": "Per-config stats for one suite.",
        "additionalProperties": {
          "$ref": "#/definitions/suite_config_stats"
        }
      }
    },
    "cross_suite_consistency": {
      "type": "object",
      "description": "Coefficient of variation of per-suite pass rates within each config.",
      "additionalProperties": {
        "$ref": "#/definitions/consistency_record"
      }
    },
    "reliability_floor": {
      "type": "object",
      "description": "Per-config pessimistic performance estimate (mean - 2*std).",
      "additionalProperties": {
        "$ref": "#/definitions/reliability_floor_record"
      }
    },
    "failure_clusters": {
      "type": "array",
      "description": "Groups with failure rate > 2x overall average.",
      "items": {
        "$ref": "#/definitions/failure_cluster"
      }
    }
  },
  "definitions": {
    "suite_config_stats": {
      "type": "object",
      "required": ["n_tasks", "mean_reward", "std_dev", "min", "max", "median", "ci_95_lower", "ci_95_upper", "ci_note"],
      "properties": {
        "n_tasks": { "type": "integer", "description": "Number of tasks." },
        "mean_reward": { "type": "number", "description": "Mean task reward." },
        "std_dev": { "type": "number", "description": "Standard deviation (sample)." },
        "min": { "type": "number", "description": "Minimum reward." },
        "max": { "type": "number", "description": "Maximum reward." },
        "median": { "type": "number", "description": "Median reward." },
        "ci_95_lower": { "type": ["number", "null"], "description": "95% CI lower bound (null if insufficient data)." },
        "ci_95_upper": { "type": ["number", "null"], "description": "95% CI upper bound (null if insufficient data)." },
        "ci_note": { "type": ["string", "null"], "description": "Note if CI could not be computed (e.g., n < 5)." }
      }
    },
    "consistency_record": {
      "type": "object",
      "required": ["coefficient_of_variation", "mean_pass_rate", "std_pass_rate", "n_suites", "per_suite_rates"],
      "properties": {
        "coefficient_of_variation": { "type": ["number", "null"], "description": "CV of per-suite pass rates (lower = more consistent)." },
        "mean_pass_rate": { "type": "number" },
        "std_pass_rate": { "type": "number" },
        "n_suites": { "type": "integer", "description": "Number of suites contributing." },
        "per_suite_rates": {
          "type": "object",
          "description": "Per-suite pass rates.",
          "additionalProperties": { "type": "number" }
        }
      }
    },
    "reliability_floor_record": {
      "type": "object",
      "required": ["reliability_floor", "mean_reward", "std_dev", "n_tasks"],
      "properties": {
        "reliability_floor": { "type": "number", "description": "Pessimistic estimate: max(mean - 2*pooled_std, 0)." },
        "mean_reward": { "type": "number" },
        "std_dev": { "type": "number", "description": "Pooled standard deviation." },
        "n_tasks": { "type": "integer" }
      }
    },
    "failure_cluster": {
      "type": "object",
      "required": ["dimension", "group", "n_tasks", "n_failed", "failure_rate", "overall_failure_rate", "relative_rate", "is_failure_cluster", "description"],
      "properties": {
        "dimension": {
          "type": "string",
          "enum": ["language", "difficulty", "benchmark_suite", "mcp_benefit_score_quartile"],
          "description": "Grouping dimension."
        },
        "group": { "type": "string", "description": "Group value within the dimension." },
        "n_tasks": { "type": "integer" },
        "n_failed": { "type": "integer" },
        "failure_rate": { "type": "number", "description": "Failure rate for this group." },
        "overall_failure_rate": { "type": "number", "description": "Overall failure rate across all tasks." },
        "relative_rate": { "type": "number", "description": "Group failure rate / overall failure rate." },
        "is_failure_cluster": { "type": "boolean", "description": "True if relative_rate > 2.0." },
        "description": { "type": "string", "description": "Human-readable cluster description." }
      }
    }
  },
  "examples": [
    {
      "generated_at": "2026-02-15T12:00:00+00:00",
      "per_suite_config": {
        "ccb_pytorch": {
          "baseline": {
            "n_tasks": 11,
            "mean_reward": 0.0909,
            "std_dev": 0.3015,
            "min": 0.0,
            "max": 1.0,
            "median": 0.0,
            "ci_95_lower": 0.0,
            "ci_95_upper": 0.2727,
            "ci_note": null
          }
        }
      },
      "cross_suite_consistency": {
        "baseline": {
          "coefficient_of_variation": 0.43,
          "mean_pass_rate": 0.52,
          "std_pass_rate": 0.22,
          "n_suites": 13,
          "per_suite_rates": { "ccb_pytorch": 0.0909, "ccb_swebenchpro": 0.39 }
        }
      },
      "reliability_floor": {
        "baseline": {
          "reliability_floor": 0.0,
          "mean_reward": 0.52,
          "std_dev": 0.49,
          "n_tasks": 161
        }
      },
      "failure_clusters": [
        {
          "dimension": "difficulty",
          "group": "very_hard",
          "n_tasks": 15,
          "n_failed": 12,
          "failure_rate": 0.8,
          "overall_failure_rate": 0.31,
          "relative_rate": 2.58,
          "is_failure_cluster": true,
          "description": "very_hard tasks fail 2.6x more often than average (80% vs 31%)"
        }
      ]
    }
  ]
}
