{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Workflow Metrics",
  "description": "Output schema for scripts/workflow_metrics.py — per-task workflow-level metrics, per-category aggregates, category deltas, and navigation summary.",
  "type": "object",
  "required": ["generated_at", "methodology", "per_task", "per_category", "category_deltas", "navigation_summary"],
  "properties": {
    "generated_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of report generation."
    },
    "methodology": {
      "type": "string",
      "description": "Methodology disclaimer noting modeled estimates."
    },
    "per_task": {
      "type": "array",
      "description": "Per-task workflow metrics extracted from trace data.",
      "items": {
        "$ref": "#/definitions/task_workflow_record"
      }
    },
    "per_category": {
      "type": "object",
      "description": "Aggregated metrics grouped by workflow category.",
      "additionalProperties": {
        "$ref": "#/definitions/category_aggregate"
      }
    },
    "category_deltas": {
      "type": "object",
      "description": "Per-category time savings (baseline vs SG_full).",
      "additionalProperties": {
        "$ref": "#/definitions/category_delta"
      }
    },
    "navigation_summary": {
      "type": "object",
      "description": "Overall navigation metrics grouped by config.",
      "additionalProperties": {
        "$ref": "#/definitions/navigation_config_summary"
      }
    }
  },
  "definitions": {
    "task_workflow_record": {
      "type": "object",
      "required": ["task_name", "suite", "config", "workflow_category", "reward", "agent_task_time_seconds", "tool_call_count", "file_read_count", "file_edit_count", "search_query_count", "mcp_call_count", "unique_files_accessed", "navigation_ratio", "context_switch_count"],
      "properties": {
        "task_name": { "type": "string", "description": "Task identifier (hash-stripped)." },
        "suite": { "type": "string", "description": "Benchmark suite (e.g., ccb_pytorch)." },
        "config": { "type": "string", "description": "Agent configuration (baseline, sourcegraph_base, sourcegraph_full)." },
        "workflow_category": { "type": ["string", "null"], "description": "Mapped workflow category from taxonomy." },
        "reward": { "type": ["number", "null"], "description": "Task reward (0.0 or 1.0)." },
        "agent_task_time_seconds": { "type": ["number", "null"], "description": "Agent task time in seconds (coding + tool use)." },
        "tool_call_count": { "type": "integer", "description": "Total tool calls." },
        "file_read_count": { "type": "integer", "description": "Number of Read tool calls." },
        "file_edit_count": { "type": "integer", "description": "Number of Edit/Write/NotebookEdit calls." },
        "search_query_count": { "type": "integer", "description": "Number of Grep + Glob calls." },
        "mcp_call_count": { "type": "integer", "description": "Number of MCP (Sourcegraph) tool calls." },
        "unique_files_accessed": { "type": "integer", "description": "Count of distinct files accessed." },
        "navigation_ratio": { "type": "number", "description": "Ratio of navigation/search calls to total tool calls." },
        "context_switch_count": { "type": "integer", "description": "Number of transitions between distinct files." }
      }
    },
    "category_aggregate": {
      "type": "object",
      "required": ["description", "suites", "configs"],
      "properties": {
        "description": { "type": "string", "description": "Workflow category description." },
        "suites": { "type": "array", "items": { "type": "string" }, "description": "Benchmark suites in this category." },
        "configs": {
          "type": "object",
          "description": "Per-config aggregate stats.",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "n_tasks": { "type": "integer" },
              "mean_agent_task_time_seconds": { "type": ["number", "null"] },
              "median_agent_task_time_seconds": { "type": ["number", "null"] },
              "mean_navigation_ratio": { "type": ["number", "null"] },
              "mean_tool_calls": { "type": ["number", "null"] }
            }
          }
        }
      }
    },
    "category_delta": {
      "type": "object",
      "required": ["baseline_mean_time_seconds", "sg_full_mean_time_seconds", "estimated_time_saved_seconds", "estimated_time_saved_pct", "engineer_equivalent_minutes_saved", "note"],
      "properties": {
        "baseline_mean_time_seconds": { "type": ["number", "null"], "description": "Baseline mean agent task time." },
        "sg_full_mean_time_seconds": { "type": ["number", "null"], "description": "SG_full mean agent task time." },
        "estimated_time_saved_seconds": { "type": ["number", "null"], "description": "Baseline - SG_full mean time (positive = SG_full faster)." },
        "estimated_time_saved_pct": { "type": ["number", "null"], "description": "Percentage time saved." },
        "engineer_equivalent_minutes_saved": { "type": ["number", "null"], "description": "Modeled engineer-equivalent minutes saved." },
        "note": { "type": "string", "description": "Methodology note." }
      }
    },
    "navigation_config_summary": {
      "type": "object",
      "properties": {
        "n_tasks": { "type": "integer" },
        "mean_navigation_ratio": { "type": ["number", "null"] },
        "mean_search_query_count": { "type": ["number", "null"] },
        "mean_mcp_call_count": { "type": ["number", "null"] },
        "mean_context_switch_count": { "type": ["number", "null"] },
        "mean_unique_files_accessed": { "type": ["number", "null"] }
      }
    }
  },
  "examples": [
    {
      "generated_at": "2026-02-15T12:00:00+00:00",
      "methodology": "All time projections are MODELED ESTIMATES. See docs/WORKFLOW_METRICS.md.",
      "per_task": [
        {
          "task_name": "example_task",
          "suite": "ccb_pytorch",
          "config": "baseline",
          "workflow_category": "feature_implementation",
          "reward": 1.0,
          "agent_task_time_seconds": 245.5,
          "tool_call_count": 42,
          "file_read_count": 12,
          "file_edit_count": 5,
          "search_query_count": 8,
          "mcp_call_count": 0,
          "unique_files_accessed": 15,
          "navigation_ratio": 0.4762,
          "context_switch_count": 10
        }
      ],
      "per_category": {
        "feature_implementation": {
          "description": "Implementing new features or modifying existing functionality.",
          "suites": ["ccb_swebenchpro", "ccb_pytorch"],
          "configs": {
            "baseline": {
              "n_tasks": 50,
              "mean_agent_task_time_seconds": 300.5,
              "median_agent_task_time_seconds": 280.0,
              "mean_navigation_ratio": 0.38,
              "mean_tool_calls": 45.2
            }
          }
        }
      },
      "category_deltas": {
        "feature_implementation": {
          "baseline_mean_time_seconds": 300.5,
          "sg_full_mean_time_seconds": 270.2,
          "estimated_time_saved_seconds": 30.3,
          "estimated_time_saved_pct": 10.1,
          "engineer_equivalent_minutes_saved": 0.51,
          "note": "modeled estimate — see docs/WORKFLOW_METRICS.md for methodology"
        }
      },
      "navigation_summary": {
        "baseline": {
          "n_tasks": 150,
          "mean_navigation_ratio": 0.37,
          "mean_search_query_count": 12.5,
          "mean_mcp_call_count": 0.0,
          "mean_context_switch_count": 8.3,
          "mean_unique_files_accessed": 14.2
        }
      }
    }
  ]
}
